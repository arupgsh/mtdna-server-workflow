name: Contamination Checker 3
description: 
version: 1.0
website: 

cluster:

  image: us-east-1/ami-da0cf8b3
  type: m1.large,m1.xlarge
  ports: 80,50030,50070
  creationOnly: false
  installMapred: true
  initScript: install.sh
  service: hadoop
 
mapred:


  steps:
 
#if( $inType == "se" || $inType == "pe")
    - name: Align Reads
      classname: genepi.cnv.align.AlignTool
      jar: cnv-mutation-server-1.0.jar
      generates: $bwaOut

    - name: Sort Aligned Reads
      classname: genepi.cnv.sort.SortTool
      jar: cnv-mutation-server-1.0.jar
      generates: $localOutput
#set( $input = $outputBam )
#end

    - name: Generate Pileup File
      classname: genepi.cnv.pileup.PileupTool
      jar: cnv-mutation-server-1.0.jar
      generates: $rawHdfs $statisticsBam 
      
    - name: Generate HSD File
      jar: mitolib-0.1.0.jar
      params: splitter --in $variantsLocal --out ${haplogrepInput}.hsd 
      
    - name: Haplogroup Contamination Check
      jar: HaplogrepCMD2.jar
      params: --format hsd --in ${haplogrepInput}.hsd --out ${haplogroups}.txt --phylotree 17
      
    - name: Check HaploGrep File for Contamination
      jar: mitolib-0.1.0.jar
      params: contChecker --inVar $variantsLocal --inHG2 ${haplogroups}.txt  --out ${contaminated}.txt  
      
  
  inputs:

    - id: input
      description: Input Files (FASTQ SE/PE, SAM/BAM) <br><br>or use the <a href="/index.html#!pages/upload-tool">Upload-Tool</a>
      type: hdfs-folder

    - id: archive
      description: Reference Archive (tar.gz)
      type: local-file
      visible: true

    - id: inType
      description: Input Format
      type: list
      required: true
      values:
        se: Fastq Single-End
        pe: Fastq Paired-End
        bam: SAM | BAM | CRAM
      value: pe
    
    - id: level
      description: Detection Level in %
      type: number
      value: 1
      visible: true
      
    - id: mapQuality
      description: Min. Mapping quality
      type: number
      value: 20
      visible: true

    - id: alignQuality
      description: Min Alignment quality
      visible: true
      type: number
      value: 30     
      
    - id: baseQuality
      description: Min. Base quality
      type: number
      value: 20
      visible: true

    - id: chunkLength
      description: Split after x bases; 0 no split
      type: number
      value: 0
      visible: true

    - id: baq
      description: Execute BAQ
      type: checkbox
      visible: true
      values:
        true: true
        false: false
      value: false
      
    - id: fileSize
      description: Filesize to upload
      type: number
      value: 10000
      visible: false
              
    - id: submissionSource
      description: submission source
      type: text
      value: web
      visible: false

  outputs:

    - id: report
      description: Interactive Report
      type: local-file
      download: true 

    - id: variants_annotated
      description: Annotated Variants
      type: local-file
      download: true
      
    - id: variants
      description: Variants
      type: local-file
      download: true 

    - id: multiallelic
      description: Multiallelic Variants
      type: local-file
      download: true

    - id: uncovered_pos
      description: Uncovered Positions
      type: local-file
      download: true 

    - id: raw
      description: Raw Pileup File
      type: local-file
      download: true  
      zip: true

    - id: statistics
      description: Statistics
      type: local-file
      download: true  
      zip: false

    - id: statisticsBam
      description: BAM Statistics
      type: hdfs-folder
      download: false
      temp: true
      mergeOutput: true
      removeHeader: false
      zip: false
      autoExport: true

    - id: outputBam
      description: BAM files
      type: hdfs-folder
      download: true
      temp: false
      zip: false
      mergeOutput: false

    - id: bwaOut
      description: BWA-MEM out
      type: hdfs-folder
      removeHeader: false
      download: false
      temp: true

    - id: localOutput
      description: BAM Files
      type: local-folder
      download: false
      temp: true

    - id: rawHdfs
      description: raw
      type: hdfs-folder
      removeHeader: false
      download: false
      temp: true

    - id: rawLocal
      description: Raw file
      type: local-file
      removeHeader: false
      download: true
      temp: false

    - id: variantsHdfs
      description: Variants
      type: hdfs-folder
      removeHeader: false
      download: false
      temp: true

    - id: variantsLocal
      description: Variants file
      type: local-file
      removeHeader: false
      download: true
      temp: false
      
    - id: haplogrepInput
      description: HaploGrep Input File
      type: local-file
      download: true
      
    - id: haplogroups
      description: Detected Haplogroups with HaploGrep
      type: local-file
      download: true
      
    - id: contaminated
      description: Detected Haplogroups Contamination with HaploGrep
      type: local-file
      download: true
